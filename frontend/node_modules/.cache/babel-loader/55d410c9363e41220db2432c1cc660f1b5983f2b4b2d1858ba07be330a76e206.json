{"ast":null,"code":"import{useEffect,useState}from'react';import{useSelector}from'react-redux';import{PrivateContent,H2}from'../../components';import{TableRow,UserRow}from'./components';import{useServerRequest}from'../../hooks';import{ROLE}from'../../constants';import{checkAccess}from'../../utils/check-access';import{selectUserRole}from'../../selectors';import styled from'styled-components';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UsersContainer=_ref=>{let{className}=_ref;const[users,setUsers]=useState([]);const[roles,setRoles]=useState([]);const[errorMessage,setErrorMessage]=useState(null);const[shouldUpdateUsersList,setShouldUpdateUsersList]=useState(false);const userRole=useSelector(selectUserRole);const requestServer=useServerRequest();useEffect(()=>{if(!checkAccess([ROLE.ADMIN],userRole))return;Promise.all([requestServer('fetchUsers'),requestServer('fetchRoles')]).then(_ref2=>{let[usersRes,rolesRes]=_ref2;if(usersRes.error||rolesRes.error){setErrorMessage(usersRes.error||rolesRes.error);return;}setUsers(usersRes.res);setRoles(rolesRes.res);});},[requestServer,shouldUpdateUsersList,userRole]);const onUserRemove=userId=>{if(!checkAccess([ROLE.ADMIN],userRole))return;requestServer('removeUser',userId).then(()=>{setShouldUpdateUsersList(!shouldUpdateUsersList);});};return/*#__PURE__*/_jsx(\"div\",{className:className,children:/*#__PURE__*/_jsxs(PrivateContent,{access:[ROLE.ADMIN],serverError:errorMessage,children:[/*#__PURE__*/_jsx(H2,{children:\"\\u041F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0438\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"login-column\",children:\"\\u041B\\u043E\\u0433\\u0438\\u043D\"}),/*#__PURE__*/_jsx(\"div\",{className:\"registered-at-column\",children:\"\\u0414\\u0430\\u0442\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"div\",{className:\"role-id-column\",children:\"\\u0420\\u043E\\u043B\\u044C\"})]}),users.map(_ref3=>{let{id,login,registeredAt,roleId}=_ref3;return/*#__PURE__*/_jsx(UserRow,{id:id,login:login,registeredAt:registeredAt,roleId:roleId,roles:roles.filter(_ref4=>{let{id:roleId}=_ref4;return roleId!==ROLE.GUEST;}),onUserRemove:()=>onUserRemove(id)},id);})]})]})});};export const Users=styled(UsersContainer)`\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\twidth: 600px;\n\tmargin: 0 auto;\n\tfont-size: 18px;\n`;","map":{"version":3,"names":["useEffect","useState","useSelector","PrivateContent","H2","TableRow","UserRow","useServerRequest","ROLE","checkAccess","selectUserRole","styled","jsx","_jsx","jsxs","_jsxs","UsersContainer","_ref","className","users","setUsers","roles","setRoles","errorMessage","setErrorMessage","shouldUpdateUsersList","setShouldUpdateUsersList","userRole","requestServer","ADMIN","Promise","all","then","_ref2","usersRes","rolesRes","error","res","onUserRemove","userId","children","access","serverError","map","_ref3","id","login","registeredAt","roleId","filter","_ref4","GUEST","Users"],"sources":["/Users/evgeniapodoprigora/Desktop/practice/frontend/src/pages/users/users.js"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { PrivateContent, H2 } from '../../components';\nimport { TableRow, UserRow } from './components';\nimport { useServerRequest } from '../../hooks';\nimport { ROLE } from '../../constants';\nimport { checkAccess } from '../../utils/check-access';\nimport { selectUserRole } from '../../selectors';\n\nimport styled from 'styled-components';\n\nconst UsersContainer = ({ className }) => {\n\tconst [users, setUsers] = useState([]);\n\tconst [roles, setRoles] = useState([]);\n\tconst [errorMessage, setErrorMessage] = useState(null);\n\tconst [shouldUpdateUsersList, setShouldUpdateUsersList] = useState(false);\n\tconst userRole = useSelector(selectUserRole);\n\tconst requestServer = useServerRequest();\n\n\tuseEffect(() => {\n\t\tif (!checkAccess([ROLE.ADMIN], userRole)) return;\n\t\tPromise.all([requestServer('fetchUsers'), requestServer('fetchRoles')]).then(\n\t\t\t([usersRes, rolesRes]) => {\n\t\t\t\tif (usersRes.error || rolesRes.error) {\n\t\t\t\t\tsetErrorMessage(usersRes.error || rolesRes.error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetUsers(usersRes.res);\n\t\t\t\tsetRoles(rolesRes.res);\n\t\t\t},\n\t\t);\n\t}, [requestServer, shouldUpdateUsersList, userRole]);\n\n\tconst onUserRemove = (userId) => {\n\t\tif (!checkAccess([ROLE.ADMIN], userRole)) return;\n\t\trequestServer('removeUser', userId).then(() => {\n\t\t\tsetShouldUpdateUsersList(!shouldUpdateUsersList);\n\t\t});\n\t};\n\n\treturn (\n\t\t<div className={className}>\n\t\t\t<PrivateContent access={[ROLE.ADMIN]} serverError={errorMessage}>\n\t\t\t\t<H2>Пользователи</H2>\n\t\t\t\t<div>\n\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t<div className=\"login-column\">Логин</div>\n\t\t\t\t\t\t<div className=\"registered-at-column\">Дата регистрации</div>\n\t\t\t\t\t\t<div className=\"role-id-column\">Роль</div>\n\t\t\t\t\t</TableRow>\n\t\t\t\t\t{users.map(({ id, login, registeredAt, roleId }) => (\n\t\t\t\t\t\t<UserRow\n\t\t\t\t\t\t\tkey={id}\n\t\t\t\t\t\t\tid={id}\n\t\t\t\t\t\t\tlogin={login}\n\t\t\t\t\t\t\tregisteredAt={registeredAt}\n\t\t\t\t\t\t\troleId={roleId}\n\t\t\t\t\t\t\troles={roles.filter(\n\t\t\t\t\t\t\t\t({ id: roleId }) => roleId !== ROLE.GUEST,\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tonUserRemove={() => onUserRemove(id)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t</PrivateContent>\n\t\t</div>\n\t);\n};\n\nexport const Users = styled(UsersContainer)`\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\twidth: 600px;\n\tmargin: 0 auto;\n\tfont-size: 18px;\n`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}